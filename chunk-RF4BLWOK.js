import{a as L}from"./chunk-4ES74N7C.js";import{a as E}from"./chunk-IE7FL6W3.js";import{a as $}from"./chunk-S6EYQB2B.js";import{e as A}from"./chunk-RPTWPSZO.js";import{Ab as q,Cb as z,H as g,L as c,M as C,N as y,Na as P,P as I,Wa as R,Y as u,Z as _,_ as v,_a as F,a as d,eb as M,f as h,fa as x,i as m,jb as B,pa as k,qa as b,s as S,tb as D,xa as j,ya as T,zb as N}from"./chunk-LNCFTXGA.js";var w={formId:"booksection",title:"Booksection",components:[{name:"Text",key:"title",focused:!0,fields:[{name:"Placeholder",value:"fill booksection title"},{name:"Label",value:"Title"}]},{name:"Select",key:"template",fields:[{name:"Placeholder",value:"fill book template"},{name:"Items",value:[]}]}]};function G(n,e){if(n&1&&(_(0,"div",3),j(1,"json"),k(2),v()),n&2){let p=e.$implicit,s=x();u("title",T(1,2,p.data)),g(2),b(p.template||s.book.template)}}function H(n,e){if(n&1&&k(0),n&2){let p=e.$implicit;b(p.data==null?null:p.data.output)}}var J=(()=>{let e=class e{constructor(s,r,i,l,f,O,V,W){this._booksectionService=s,this._templateService=r,this._translate=i,this._bookService=l,this._alert=f,this._form=O,this._core=V,this._router=W,this.columns=["title","template","output"],this.templates=w.components[1].fields[1].value,this.book=this._bookService.doc(this._router.url.replace("/sections/","")),this.bookInfo={formId:"booksectioninfo",title:"Section information",components:[]},this.form=this._form.getForm("booksection",w),this.config={num:!0,paginate:this.setRows.bind(this),perPage:20,pageSizeOptions:[10,20,50,100],setPerPage:this._booksectionService.setPerPage.bind(this._booksectionService),allDocs:!1,create:()=>{this._form.modal(this.form,{label:"Create",click:(t,o)=>h(this,null,function*(){o(),this._preCreate(t),yield m(this._booksectionService.create(t)),this.setRows()})})},update:t=>{this._form.modal(this.form,[],t).then(o=>{this._core.copy(o,t),this._booksectionService.update(t)})},delete:t=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this booksection?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>h(this,null,function*(){yield m(this._booksectionService.delete(t)),this.setRows()})}]})},buttons:[{icon:"edit_note",click:t=>{this.bookInfo.components=(this._templateService.template[t.template||this.book.template]||[]).map(o=>({name:this._templateService.form[o]||"Text",key:o,fields:[...this._templateService.field[o]||[],{name:"Placeholder",value:"fill section "+o},{name:"Label",value:o.capitalize()},{name:"Textarea",value:!0}]})),this._form.modal(this.bookInfo,[],t.data).then(o=>{delete o.data,t.data=d(d({},t.data),o),this._booksectionService.update(t)})}},{icon:"arrow_upward",click:t=>{let o=this.rows.findIndex(a=>a._id===t._id);o&&(this.rows.splice(o,1),this.rows.splice(o-1,0,t));for(let a=0;a<this.rows.length;a++)this.rows[a].order!==a&&(this.rows[a].order=a,this._booksectionService.update(this.rows[a]))}}],headerButtons:[{icon:"playlist_add",click:this._bulkManagement(),class:"playlist"},{icon:"edit_note",click:this._bulkManagement(!1),class:"edit"}]},this.rows=[],this._page=1,this.setRows(),this.templates.push(...this._templateService.templates)}setRows(s=this._page){this._page=s,this._core.afterWhile(this,()=>{this._booksectionService.get({page:s,query:"book = "+this._router.url.replace("/sections/","")}).subscribe(r=>{this.rows.splice(0,this.rows.length),this.rows.push(...r)})},250)}_bulkManagement(s=!0){return()=>{this._form.modalDocs(s?[]:this.rows).then(r=>h(this,null,function*(){if(s)for(let i of r)this._preCreate(i),yield m(this._booksectionService.create(i));else{for(let i of this.rows)r.find(l=>l._id===i._id)||(yield m(this._booksectionService.delete(i)));for(let i of r){let l=this.rows.find(f=>f._id===i._id);l?(this._core.copy(i,l),yield m(this._booksectionService.update(l))):(this._preCreate(i),yield m(this._booksectionService.create(i)))}}this.setRows()}))}}_preCreate(s){delete s.__created,s.book=this.book._id}};e.\u0275fac=function(r){return new(r||e)(c(E),c(L),c(D),c($),c(B),c(z),c(M),c(R))},e.\u0275cmp=C({type:e,selectors:[["ng-component"]],standalone:!1,decls:3,vars:3,consts:[["title","Sections",3,"columns","config","rows"],["cell","template"],["cell","output"],[3,"title"]],template:function(r,i){r&1&&(_(0,"wtable",0),I(1,G,3,4,"ng-template",1)(2,H,1,1,"ng-template",2),v()),r&2&&u("columns",i.columns)("config",i.config)("rows",i.rows)},dependencies:[q,N,P],encapsulation:2});let n=e;return n})();var K=[{path:":book",component:J}],de=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=y({type:e}),e.\u0275inj=S({imports:[F.forChild(K),A]});let n=e;return n})();export{de as SectionsModule};
